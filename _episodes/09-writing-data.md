---
# Please do not edit this file directly; it is auto generated.
# Instead, please edit 09-writing-data.md in _episodes_rmd/
title: Writing Data
teaching: 10
exercises: 10
questions:
- "How can I save plots and data created in R?"
objectives:
- "To be able to write out plots and data from R."
keypoints:
- "Save plots from RStudio using the 'Export' button."
- "Use `write.table` to save tabular data."
source: Rmd
---




## Saving plots

You have already seen how to save the most recent plot you create in `ggplot2`,
using the command `ggsave`. As a refresher:


~~~
ggsave("My_most_recent_plot.pdf")
~~~
{: .language-r}

You can save a plot from within RStudio using the 'Export' button
in the 'Plot' window. This will give you the option of saving as a
.pdf or as .png, .jpg or other image formats.

Sometimes you will want to save plots without creating them in the
'Plot' window first. Perhaps you want to make a pdf document with
multiple pages: each one a different plot, for example. Or perhaps
you're looping through multiple subsets of a file, plotting data from
each subset, and you want to save each plot, but obviously can't stop
the loop to click 'Export' for each one.

In this case you can use a more flexible approach. The function
`pdf` creates a new pdf device. You can control the size and resolution
using the arguments to this function.


~~~
pdf("Life_Exp_vs_time.pdf", width=12, height=4)
ggplot(data=gapminder, aes(x=year, y=lifeExp, colour=country)) +
  geom_line() +
  theme(legend.position = "none")

# You then have to make sure to turn off the pdf device!

dev.off()
~~~
{: .language-r}

Open up this document and have a look.

> ## Challenge 1
>
> Rewrite your 'pdf' command to print a second
> page in the pdf, showing a facet plot (hint: use `facet_grid`)
> of the same data with one panel per continent.
> > ## Solution to challenge 1
> >
> > 
> > ~~~
> > pdf("Life_Exp_vs_time.pdf", width = 12, height = 4)
> > p <- ggplot(data = gapminder, aes(x = year, y = lifeExp, colour = country)) +
> >   geom_line() +
> >   theme(legend.position = "none")
> > p
> > p + facet_grid(~continent)
> > dev.off()
> > ~~~
> > {: .language-r}
> {: .solution}
{: .challenge}


The commands `jpeg`, `png` etc. are used similarly to produce
documents in different formats.

## Writing data

At some point, you'll also want to write out data from R.

We can use the `write.table` function for this, which is
very similar to `read.table` from before.

Let's create a data-cleaning script, for this analysis, we
only want to focus on the gapminder data for Australia.
Before creating the file, make sure you have a directory called
`cleaned-data` (use `New Folder` in the `Files` pane). We separate these from the original datafiles to make it clear what is source data and what is working or modified data.


~~~
aust_subset <- gapminder[gapminder$country == "Australia",]

write.table(aust_subset,
  file="cleaned-data/gapminder-aus.csv",
  sep=","
)
~~~
{: .language-r}

In the `Files` pane, navigate to `cleaned-data`, click on `gapminder-aus.csv` and choose `View File` to take a look at the data and make sure it looks OK:

![RStudio View File for gapminder-aus.csv](../fig/09-gapminder-aus-quotes.png)

Hmm, that's not quite what we wanted. Where did all these
quotation marks come from? Also the row numbers are
meaningless.

Let's look at the help file to work out how to change this
behaviour.


~~~
?write.table
~~~
{: .language-r}

By default R will wrap character vectors with quotation marks
when writing out to file. It will also write out the row and
column names.

Let's fix this:


~~~
write.table(
  gapminder[gapminder$country == "Australia",],
  file="cleaned-data/gapminder-aus.csv",
  sep=",", quote=FALSE, row.names=FALSE
)
~~~
{: .language-r}

Now lets look at the data again using `View File`:

![RStudio View File for gapminder-aus.csv (now fixed!)](../fig/09-gapminder-aus-fixed.png)

That looks better!

> ## Challenge 2
>
> Write a data-cleaning script file that subsets the gapminder
> data to include only data points collected since 1990.
>
> Use this script to write out the new subset to a file
> in the `cleaned-data/` directory.
> > ## Solution to challenge 2
> >
> > 
> > ~~~
> > write.table(
> >   gapminder[gapminder$year > 1990, ],
> >   file = "cleaned-data/gapminder-after1990.csv",
> >   sep = ",", quote = FALSE, row.names = FALSE
> > )
> > ~~~
> > {: .language-r}
> {: .solution}
{: .challenge}


